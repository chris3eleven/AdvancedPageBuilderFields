!function(_){function n(t){$selectedPosts=[],t.find(".apbf-multiselect__posts-selected").find(".apbf-multiselect__item").each(function(){null!=_(this).attr("data-id")&&$selectedPosts.push(_(this).attr("data-id"))}),t.find(".apbf-multiselect__value").val(JSON.stringify($selectedPosts))}function l(e,t,s,l,a,i,o,p,c,d){$listBox=e.closest(".apbf-multiselect"),e.data("loading",!0),e.data("loadcomplete",!1),d&&e.empty(),e.find(".apbf-multiselect__item--message").remove(),e.append('<li class="apbf-multiselect__item apbf-multiselect__item--message apbf-multiselect__item--disabled apbf-multiselect__item--loading">Loading...</ul>'),_.ajax({type:"POST",url:ajax.url,data:{action:"apbf_get_posts",post_type:s,search_title:t,post_taxonomy:l,post_term:a,post__in:i,order:p,paged:c,posts_per_page:o},success:function(t){c++,e.find(".apbf-multiselect__item--message").remove(),e.data("nextPage",parseInt(c)),$response=JSON.parse(t),"success"==$response.result?($selectedPosts=e.closest(".apbf-multiselect").find(".apbf-multiselect__value").val(),""!=$selectedPosts&&null!=$selectedPosts?$selectedPosts=JSON.parse($selectedPosts):$selectedPosts=[],_.isEmptyObject($response.results)||($response.pagination.more||e.data("loadcomplete",!0),_.each($response.results,function(t,s){$listItem=_("<li></li>").addClass("apbf-multiselect__item"),$listItem.attr("data-id",s.id),$listItem.text(s.text),$listItem.click(function(){var t;(t=_(this)).hasClass("apbf-multiselect__item--disabled")||($listBox=t.closest(".apbf-multiselect"),t.closest(".apbf-multiselect__posts").hasClass("apbf-multiselect__posts-posts")?(t.clone(!0).addClass("ui-sortable-handle").appendTo(t.closest(".apbf-multiselect").find(".apbf-multiselect__posts-selected")),t.addClass("apbf-multiselect__item--disabled")):(t.closest(".apbf-multiselect").find(".apbf-multiselect__posts-posts").find("[data-id="+t.attr("data-id")+"]").removeClass("apbf-multiselect__item--disabled"),t.remove()),n($listBox))}),e.hasClass("apbf-multiselect__posts-posts")&&-1!=_.inArray(s.id.toString(),$selectedPosts)&&$listItem.addClass("apbf-multiselect__item--disabled"),e.append($listItem)}),e.data("loading",!1))):"empty"==$response.result&&e.append('<li class="apbf-multiselect__item apbf-multiselect__item--message apbf-multiselect__item--disabled">Nothing found.</ul>')},error:function(t){e.find(".apbf-multiselect__item--message").remove(),e.append('<li class="apbf-multiselect__item apbf-multiselect__item--message apbf-multiselect__item--disabled apbf-multiselect__item--error">An error occurred, please reload the page and try again.</ul>')}})}var t;_(window).on("panelsopen",function(t){_(".so-panels-dialog .apbf-multiselect").each(function(){_(this).find(".apbf-multiselect__posts-posts").scroll(function(){var t;(t=_(this))[0].scrollHeight-t.scrollTop()<=t.outerHeight()&&!t.data("loadcomplete")&&!t.data("loading")&&l(t,null,t.attr("data-post_type"),t.attr("data-post_taxonomy"),t.attr("data-post_term"),t.attr("data-posts"),10,null,t.data("nextPage"),!1)}),$posts_list=_(this).find(".apbf-multiselect__posts-posts"),l($posts_list,null,$posts_list.attr("data-post_type"),$posts_list.attr("data-post_taxonomy"),$posts_list.attr("data-post_term"),null,10,null,1,!0),$selectedPosts=_(this).find(".apbf-multiselect__value").val(),""!=$selectedPosts&&null!=$selectedPosts&&($selectedPosts=JSON.parse($selectedPosts).toString(),_.isEmptyObject($selectedPosts)||l(_(this).find(".apbf-multiselect__posts-selected"),null,null,null,null,$selectedPosts,-1,"custom",1,!0)),_(this).find(".apbf-multiselect__posts-selected").sortable({axis:"y",stop:function(){n(_(this).closest(".apbf-multiselect"))}}),_(this).find(".apbf-multiselect__posts-selected").disableSelection()})}),_(document).ready(function(){_(document).on("change",".apbf-multiselect__filters select",function(){var t=_(this).closest(".apbf-multiselect"),s=t.find(".apbf-multiselect__search").val();$posts_list=t.find(".apbf-multiselect__posts-posts");var e=_(this).val();""==e||("post_type"==(e=e.split(":"))[0]&&$posts_list.attr("data-post_type",e[1]),"term"==e[0]&&("all"==e[1]?($posts_list.attr("data-post_taxonomy",""),$posts_list.attr("data-post_term","")):($posts_list.attr("data-post_taxonomy",e[1]),$posts_list.attr("data-post_term",e[2]))),l($posts_list,s,$posts_list.attr("data-post_type"),$posts_list.attr("data-post_taxonomy"),$posts_list.attr("data-post_term"),null,10,null,1,!0))}),_(document).on("keyup",".apbf-multiselect__search",function(){null!=t&&clearTimeout(t),$search=_(this).val(),$posts_list=_(this).closest(".apbf-multiselect").find(".apbf-multiselect__posts-posts"),t=setTimeout(function(){var t,s;t=$search,l(s=$posts_list,t,s.attr("data-post_type"),s.attr("data-post_taxonomy"),s.attr("data-post_term"),null,10,null,1,!0)},250)})})}(jQuery);